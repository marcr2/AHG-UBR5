graph TD
  U["User"] --> S["Streamlit App<br/>Main.py + pages/"]
  S --> DP["1_Data_Processing (Streamlit)"]
  DP --> PX["process_xrvix_dumps_json.py"]
  PX --> XE["xrvix_embeddings/ (multi-file)"]
  S --> HG["2_Hypothesis_Generator (Streamlit)"]
  HG --> RAG["EnhancedRAGQuery<br/>search_hybrid + package"]
  RAG --> DB["ChromaDB (persistent ./chroma_db)"]
  RAG --> GC["HypothesisGenerator + Critic (Gemini)"]
  GC --> OUT["Hypotheses + citations<br/>Excel export"]

  subgraph CLI Pipeline
    MP["master_processor.py"] --> PS["pubmed_scraper_json.py"]
    PS --> PE["xrvix_embeddings/pubmed_embeddings.json"]
    MP --> CM["ChromaDBManager<br/>create_collection + add_embeddings"]
    CM --> DB
    MP --> PX
    XE --> CM
    PE --> CM
  end